<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Chat</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #chat-container { width: 100%; max-width: 600px; height: 90vh; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        #messages { flex-grow: 1; overflow-y: auto; padding: 20px; border-bottom: 1px solid #ddd; }
        #messages div { margin-bottom: 10px; line-height: 1.4; }
        #messages strong { color: #007bff; }
        #form { display: flex; padding: 20px; }
        #username-input { border: 1px solid #ddd; padding: 10px; border-radius: 20px; margin-right: 10px; width: 120px; }
        #input { flex-grow: 1; border: 1px solid #ddd; padding: 10px; border-radius: 20px; margin-right: 10px; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="messages"></div>
    <form id="form" action="">
        <input id="username-input" placeholder="Your Name" autocomplete="off" required />
        <input id="input" placeholder="Type a message..." autocomplete="off" required />
        <button>Send</button>
    </form>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const socket = io();

        const messagesContainer = document.getElementById('messages');
        const chatForm = document.getElementById('form');
        const messageInput = document.getElementById('input');
        const usernameInput = document.getElementById('username-input');

        function addMessage(msg) {
            const item = document.createElement('div');
            const strong = document.createElement('strong');
            strong.innerText = `${msg.username}: `;
            item.appendChild(strong);
            item.append(document.createTextNode(msg.text));
            messagesContainer.appendChild(item);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (messageInput.value && usernameInput.value) {
                socket.emit('send_message', {
                    username: usernameInput.value,
                    text: messageInput.value,
                    room: 'general'
                });
                messageInput.value = '';
                messageInput.focus();
            }
        });

        socket.on('history', (data) => {
            messagesContainer.innerHTML = '';
            data.messages.forEach(addMessage);
        });
        
        socket.on('new_message', (msg) => {
            addMessage(msg);
        });

        socket.emit('join', { room: 'general' });
    });
</script>

</body>
</html>